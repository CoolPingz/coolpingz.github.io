<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>问道</title>
  
  <subtitle>不积跬步无以至千里，不积小流无以成江海</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://pingz.cn/"/>
  <updated>2017-10-19T04:52:03.472Z</updated>
  <id>http://pingz.cn/</id>
  
  <author>
    <name>pingz</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Ambari编译</title>
    <link href="http://pingz.cn/2017/10/03/2017-10-03-ambari%E7%BC%96%E8%AF%91/"/>
    <id>http://pingz.cn/2017/10/03/2017-10-03-ambari编译/</id>
    <published>2017-10-03T11:07:43.000Z</published>
    <updated>2017-10-19T04:52:03.472Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-编译环境"><a href="#1-编译环境" class="headerlink" title="1 编译环境"></a>1 编译环境</h3><p>编译过程中用到以下编译工具，都需要安装好。</p><ul><li>JDK7 (Ambari 2.0 或更低版本的可以使用 JDK6)</li><li>Apache Maven 3.0.5，Maven高版本会在编译时报错</li><li>Python 2.6</li><li>Python setuptools</li><li>rpmbuild (rpm-build package)</li><li>g++ (gcc-c++ package)</li><li>NodeJS - 最新的测试过的稳定版本为v0.10.40，  0.12.x使用会有问题</li><li>Brunch 1.7.20 (请先安装NodeJS)，使用npm install -g brunch@1.7.20安装<a id="more"></a> <h4 id="1-1-安装JDK"><a href="#1-1-安装JDK" class="headerlink" title="1.1 安装JDK"></a>1.1 安装JDK</h4>步骤略<h4 id="1-2-安装Apache-Maven-3-0-5"><a href="#1-2-安装Apache-Maven-3-0-5" class="headerlink" title="1.2 安装Apache Maven 3.0.5"></a>1.2 安装Apache Maven 3.0.5</h4>安装最新的maven可能有问题，官方推荐使用3.0.5<h5 id="1-2-1-官网下载"><a href="#1-2-1-官网下载" class="headerlink" title="1.2.1 官网下载"></a>1.2.1 官网下载</h5>  wget <a href="http://apache.fayea.com/apache-mirror/maven/maven-3/3.0.5/binaries/apache-maven-3.0.5-bin.tar.gz" target="_blank" rel="external">http://apache.fayea.com/apache-mirror/maven/maven-3/3.0.5/binaries/apache-maven-3.0.5-bin.tar.gz</a><h5 id="1-2-2-解压"><a href="#1-2-2-解压" class="headerlink" title="1.2.2 解压"></a>1.2.2 解压</h5>  tar -zxvf apache-maven-3.0.5-bin.tar.gz<h5 id="1-2-3-设置环境变量"><a href="#1-2-3-设置环境变量" class="headerlink" title="1.2.3 设置环境变量"></a>1.2.3 设置环境变量</h5>  export M2_HOME=/home/qijp/workspace/app/maven-3.0.5<br>  export PATH=$PATH:$M2_HOME/bin/<h5 id="1-2-4-检查是否安装成功"><a href="#1-2-4-检查是否安装成功" class="headerlink" title="1.2.4 检查是否安装成功"></a>1.2.4 检查是否安装成功</h5>  mvn -v<br>  Apache Maven 3.0.5 (r01de14724cdef164cd33c7c8c2fe155faf9602da; 2013-02-19 21:51:28+0800)<br>  Maven home: /home/qijp/workspace/app/maven-3.0.5<br>  Java version: 1.7.0_21, vendor: Oracle Corporation<br>  Java home: /home/qijp/workspace/app/jdk1.7.0_21/jre<br>  Default locale: zh_CN, platform encoding: UTF-8<br>  OS name: “linux”, version: “2.6.32-358.el6.x86_64”, arch: “amd64”, family: “unix”</li></ul><h4 id="1-3-安装nodejs、npm"><a href="#1-3-安装nodejs、npm" class="headerlink" title="1.3 安装nodejs、npm"></a>1.3 安装nodejs、npm</h4><h5 id="1-3-1-获取node-js"><a href="#1-3-1-获取node-js" class="headerlink" title="1.3.1 获取node.js"></a>1.3.1 获取node.js</h5><pre><code>wget http://nodejs.org/dist/v0.10.33/node-v0.10.33-linux-x64.tar.gz</code></pre><h5 id="1-3-2-解压"><a href="#1-3-2-解压" class="headerlink" title="1.3.2 解压"></a>1.3.2 解压</h5><pre><code>tar -zxvf node-v0.10.33-linux-x64.tar.gz</code></pre><h5 id="1-3-3-设置环境变量"><a href="#1-3-3-设置环境变量" class="headerlink" title="1.3.3 设置环境变量"></a>1.3.3 设置环境变量</h5><pre><code>export NODE_HOME=/home/qijp/workspace/app/node-v0.10.33-linux-x64export PATH=$PATH:NODE_HOME/bin</code></pre><h5 id="1-3-4-查看是否安装成功"><a href="#1-3-4-查看是否安装成功" class="headerlink" title="1.3.4 查看是否安装成功"></a>1.3.4 查看是否安装成功</h5><pre><code>node -vv0.10.33npm -v1.4.28</code></pre><h4 id="1-4-安装brunch"><a href="#1-4-安装brunch" class="headerlink" title="1.4 安装brunch"></a>1.4 安装brunch</h4><p>brunch 推荐版本为 1.7</p><h5 id="1-4-1-获取并安装brunch"><a href="#1-4-1-获取并安装brunch" class="headerlink" title="1.4.1 获取并安装brunch"></a>1.4.1 获取并安装brunch</h5><pre><code>npm install -g brunch@1.7</code></pre><h5 id="1-4-2-brunch用法"><a href="#1-4-2-brunch用法" class="headerlink" title="1.4.2 brunch用法"></a>1.4.2 brunch用法</h5><pre><code>git clone https://git-wip-us.apache.org/repos/asf/ambari.gitcd ambari/ambari-webnpm install -g brunch@1.7rm -rf node_modules publicnpm installbrunch build</code></pre><p>然后使用</p><pre><code>brunch watch --server (or use the shorthand: brunch w -s)</code></pre><p>在host:3333端口可以直接访问web页面。</p><h4 id="1-5-安装rpmbuild"><a href="#1-5-安装rpmbuild" class="headerlink" title="1.5 安装rpmbuild"></a>1.5 安装rpmbuild</h4><h5 id="1-5-1-检测rpm-build是否已经安装"><a href="#1-5-1-检测rpm-build是否已经安装" class="headerlink" title="1.5.1 检测rpm-build是否已经安装"></a>1.5.1 检测rpm-build是否已经安装</h5><pre><code>rpm -qa | grep rpm-build</code></pre><h5 id="1-5-2-安装"><a href="#1-5-2-安装" class="headerlink" title="1.5.2 安装"></a>1.5.2 安装</h5><pre><code>yum install rpm-build</code></pre><h4 id="1-6-安装g"><a href="#1-6-安装g" class="headerlink" title="1.6 安装g++"></a>1.6 安装g++</h4><h5 id="1-6-1-检测g-是否已经安装"><a href="#1-6-1-检测g-是否已经安装" class="headerlink" title="1.6.1 检测g++是否已经安装"></a>1.6.1 检测g++是否已经安装</h5><pre><code>rpm -qa | grep gcc-c++</code></pre><h5 id="1-6-2-安装"><a href="#1-6-2-安装" class="headerlink" title="1.6.2 安装"></a>1.6.2 安装</h5><pre><code>yum install gcc-c++</code></pre><h3 id="2-编译Ambari"><a href="#2-编译Ambari" class="headerlink" title="2 编译Ambari"></a>2 编译Ambari</h3><h4 id="2-1-下载源码，设置版本号"><a href="#2-1-下载源码，设置版本号" class="headerlink" title="2.1 下载源码，设置版本号"></a>2.1 下载源码，设置版本号</h4><pre><code>git clone https://github.com/ailkgithub/ambari.gitgit checkout -b branch-2.2.1 origin/branch-2.2.1cd ambarimvn versions:set -DnewVersion=2.2.1.0.0pushd ambari-metricsmvn versions:set -DnewVersion=2.2.1.0.0popd</code></pre><h4 id="2-2-编译"><a href="#2-2-编译" class="headerlink" title="2.2 编译"></a>2.2 编译</h4><pre><code>mvn -B clean install package rpm:rpm -DnewVersion=2.2.1.0.0 -DskipTests -Dpython.ver=&quot;python &gt;= 2.6&quot;</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">[INFO] ------------------------------------------------------------------------</div><div class="line">[INFO] Reactor Summary:</div><div class="line">[INFO]</div><div class="line">[INFO] Ambari Main ....................................... SUCCESS [10.835s]</div><div class="line">[INFO] Apache Ambari Project POM ......................... SUCCESS [0.487s]</div><div class="line">[INFO] Ambari Web ........................................ SUCCESS [1:23.770s]</div><div class="line">[INFO] Ambari Views ...................................... SUCCESS [4.859s]</div><div class="line">[INFO] Ambari Admin View ................................. SUCCESS [3:04.720s]</div><div class="line">[INFO] ambari-metrics .................................... SUCCESS [1.284s]</div><div class="line">[INFO] Ambari Metrics Common ............................. SUCCESS [2.935s]</div><div class="line">[INFO] Ambari Metrics Hadoop Sink ........................ SUCCESS [7.125s]</div><div class="line">[INFO] Ambari Metrics Flume Sink ......................... SUCCESS [3.142s]</div><div class="line">[INFO] Ambari Metrics Kafka Sink ......................... SUCCESS [3.725s]</div><div class="line">[INFO] Ambari Metrics Storm Sink ......................... SUCCESS [8.989s]</div><div class="line">[INFO] Ambari Metrics Collector .......................... SUCCESS [4:38.784s]</div><div class="line">[INFO] Ambari Metrics Monitor ............................ SUCCESS [3.528s]</div><div class="line">[INFO] Ambari Metrics Assembly ........................... SUCCESS [6:53.910s]</div><div class="line">[INFO] Ambari Server ..................................... SUCCESS [11:00.509s]</div><div class="line">[INFO] Ambari Agent ...................................... SUCCESS [29.996s]</div><div class="line">[INFO] Ambari Client ..................................... SUCCESS [0.574s]</div><div class="line">[INFO] Ambari Python Client .............................. SUCCESS [8.788s]</div><div class="line">[INFO] Ambari Groovy Client .............................. SUCCESS [7.968s]</div><div class="line">[INFO] Ambari Shell ...................................... SUCCESS [0.219s]</div><div class="line">[INFO] Ambari Python Shell ............................... SUCCESS [1.992s]</div><div class="line">[INFO] Ambari Groovy Shell ............................... SUCCESS [5.293s]</div><div class="line">[INFO] ------------------------------------------------------------------------</div><div class="line">[INFO] BUILD SUCCESS</div></pre></td></tr></table></figure><h4 id="2-3-安装"><a href="#2-3-安装" class="headerlink" title="2.3 安装"></a>2.3 安装</h4><pre><code>生成安装包目录ambari-server/target/rpm/ambari-server/RPMS/noarch/ambari-agent/target/rpm/ambari-agent/RPMS/x86_64/</code></pre><p>可以配置成本地yum 源，使用yum方式安装</p><pre><code>yum install ambari-server*.rpmyum install ambari-agent*.rpm</code></pre><h4 id="2-4-设置并启动ambari"><a href="#2-4-设置并启动ambari" class="headerlink" title="2.4 设置并启动ambari"></a>2.4 设置并启动ambari</h4><pre><code>ambari-server setupambari-server start</code></pre><p>###【总结】</p><h6 id="1、编译ambari-admin时出错"><a href="#1、编译ambari-admin时出错" class="headerlink" title="1、编译ambari-admin时出错"></a>1、编译ambari-admin时出错</h6><p>Additional error details:<br>fatal: unable to connect to github.com:<br>github.com[0: 192.30.252.131]: errno=Connection timed out</p><p>解决方法：<br>git config –global url.”<a href="https://github.com&quot;.insteadOf" target="_blank" rel="external">https://github.com&quot;.insteadOf</a> git://github.com</p>]]></content>
    
    <summary type="html">
    
      生命在于折腾。编译过程中用到以下编译工具，都需要安装好。
    
    </summary>
    
    
  </entry>
  
</feed>
